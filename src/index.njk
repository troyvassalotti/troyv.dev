{% extends 'layouts/base.njk' %}

{% block script %}
  {{ super() }}
  <script>
    // TODO
    const sloganLocation = document.querySelector(".js-slogan");
  </script>
{% endblock %}

{% block content %}
  <main id="main">
    <cloudy-sky hillside>
      <div class="wrapper">
        <div class="o-hero">
          <section class="o-hero__left flow">
            <div class="c-keyboard">
              <kb-typewriter>
                <h1 class="leadingType">Hey, I'm Troy...</h1>
              </kb-typewriter>
              <kb-typewriter>
                <p class="followingType">...and this is a website.</p>
              </kb-typewriter>
            </div>
            <figure class="c-portrait">
              <img
                src="{{ metadata.cloudinary }}/c_scale,f_auto,q_auto:eco,w_600/v1646349104/blog/me-on-stage-waverly_hoxgvf.webp"
                alt="Me holding my guitar on stage"
                decoding="async"
                width="600"
                height="600"
                id="me"
              />
              <!-- other things I am: hopeless romantic -->
              <figcaption><a href="/music/">Musician</a>, developer, and <span
                  class="js-slogan">insert your favorite descriptors here</span>.
              </figcaption>
            </figure>
            <div class="o-hero__left__note">
              <p>I'm glad you could make it. Peruse my wares* and read <a href="/about/">more about me</a> if you're so inclined.</p>
              <p class="u-text--smallest">*I only accept bottle caps as currency, sorry... (I'm kidding)</p>
            </div>
          </section>
          <section class="o-hero__right">
            <h2 id="recent-posts" class="sectionTitle">Recent Posts</h2>
            <ul role="list" class="c-postList flow">
              {% for post in collections.post.slice(collections.post.length - 5, collections.post.length) | reverse %}
                <li>
                  <post-item date="{{ post.date | dateString }}"
                             url="{{ post.url }}"
                             excerpt="{{ post.data.excerpt or post.data.description }}"
                             level="3"
                             heading="{{ post.data.title }}"></post-item>
                </li>
              {% endfor %}
            </ul>
            <p class="c-postList__more">
              <a class="c-animatedLink" href="{{ nav.header[1].url }}">View All Posts</a>
            </p>
          </section>
        </div>
      </div>
    </cloudy-sky>
    <div class="spinner" aria-hidden="true"></div>
  </main>
{% endblock %}

{% block style %}
  {{ super() }}
  <style>
    :is(cloudy-sky, kb-typewriter, post-item):not(:defined) {
      visibility: hidden;
    }

    .leadingType {
      --kb-count-cursor: 6;
      font-size: var(--step-5);
    }

    .followingType {
      --kb-delay-typing: 3.5s;
      --kb-delay-cursor: 3s;
      --kb-steps-typing: 35;
      font-family: var(--headings);
      font-size: var(--step-3);
      font-weight: bold;
      margin-block-start: 0.5ex;
    }

    .o-hero {
      column-gap: var(--space-m-l);
      display: grid;
      row-gap: var(--space-xl-2xl);
    }

    @media (min-width: 70.25rem) {
      .o-hero {
        grid-template-columns: .75fr 1fr;
      }

      .o-hero__right {
        text-align: end;
      }

      ::part(p-item) {
        align-items: end;
        border-inline-end: 2px dashed var(--accent, currentColor);
        display: flex;
        flex-direction: column;
        padding-inline-end: 1ch;
      }

      ::part(p-excerpt) {
        max-inline-size: 60ch;
      }
    }

    .o-hero__left {
      --flow-space: var(--space-s);
      text-align: center;
    }

    .o-hero__left__note p {
      margin-inline: auto;
      max-inline-size: 35rem;
    }

    .o-hero__left__note p:not(:first-of-type) {
      margin-block-start: var(--space-2xs);
    }

    @media (min-width: 52.5rem) and (max-width: 70.25rem) {
      .o-hero__left {
        column-gap: var(--space-xs);
        display: grid;
        grid-template-areas: "keyboard image" "note image";
      }

      .c-keyboard {
        align-self: end;
        grid-area: keyboard;
      }

      .c-portrait {
        grid-area: image;
      }

      .o-hero__left__note {
        grid-area: note;
      }
    }

    .c-keyboard {
      display: grid;
      justify-content: center;
    }

    .c-portrait figcaption::after,
    .c-portrait figcaption::before {
      content: " â†‘ ";
      font-size: 1.25em;
    }

    .c-portrait img {
      aspect-ratio: 1 / 1;
      border-radius: 50%;
      inline-size: calc(7 * var(--step-5));
      margin-block: 1.5rem;
      margin-inline: auto;
      transition: filter .3s ease;
    }

    .o-hero__right .sectionTitle {
      margin-block-end: var(--space-s);
    }

    .c-postList {
      --flow-space: var(--space-s-l);
    }

    .c-postList__more {
      margin-block: var(--space-s-m);
    }

    /* Loading Spinner */
    .spinner {
      animation: spinner 2s infinite linear;
      aspect-ratio: 1;
      background-image: conic-gradient(#25b09b 25%, #f03355 0 50%, #514b82 0 75%, #ffa516 0);
      border-radius: 50%;
      inline-size: 50px;
      display: grid;
      inset-block: 50vh;
      inset-inline: 0;
      margin-inline: auto;
      position: fixed;
    }

    .spinner::before,
    .spinner::after {
      animation: inherit;
      background: inherit;
      border-radius: 50%;
      content: "";
      grid-area: 1 / 1;
      margin: 15%;
    }

    .spinner::after {
      animation-duration: 3s;
      margin: 25%;
    }

    @keyframes spinner {
      100% {
        transform: rotate(1turn)
      }
    }

    cloudy-sky:defined + .spinner {
      display: none;
    }
  </style>
{% endblock %}
