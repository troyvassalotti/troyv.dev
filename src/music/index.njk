{% extends 'layouts/base.njk' %}

{% if site.serverless == "true" %}
  {% block script %}
    {{ super() }}
    <script type="module" src="/assets/js/components/data-table.js"></script>
    <script type="module" src="/assets/js/components/plvylist-player.js"></script>
  {% endblock %}
{% endif %}

{% block content %}
  <main id="main">
    <div class="wrapper constrain--less">
      <div class="central">
        <div class="o-left flow u-truncate">
          <header class="flow header">
            <h1 class="title u-text--caps u-text--base">{{ title }}</h1>
            <h2 class="callout u-line-height--less">Guitarist, drummer, singer-songwriter.</h2>
            <p>When I'm not coding, I'm probably writing, playing, or recording music. I've been performing in bands since high school, and
              you can check out my current projects below.</p>
          </header>
          <section class="o-bands flow">
            <div class="c-band c-band--frontRoyal flow">
              <h3>Front Royal</h3>
              <dl class="c-dataList">
                {% for key, value in frontRoyal.meta %}
                  <div class="c-dataList__item">
                    <dt>{{ key }}</dt>
                    <dd>{{ value }}</dd>
                  </div>
                {% endfor %}
              </dl>
              {% for link in frontRoyal.social %}
                <a href="{{ link.href }}">{% include 'partials/' + link.img %}</a>
              {% endfor %}
            </div>
            <div class="c-band c-band--troy flow">
              <h3>troy.</h3>
              <dl class="c-dataList">
                {% for key, value in troyalllowercase.meta %}
                  <div class="c-dataList__item">
                    <dt>{{ key }}</dt>
                    <dd>{{ value }}</dd>
                  </div>
                {% endfor %}
              </dl>
              {% for link in troyalllowercase.social %}
                <a href="{{ link.href }}">{% include 'partials/' + link.img %}</a>
              {% endfor %}
            </div>
          </section>
        </div>
        <div class="o-right">
          <section class="plvylist">
            <header>
              <h2 class="u-text--base u-text--caps title">You can stream here</h2>
              <p class="u-text--smaller u-text--italic">Psst... <a href="https://www.npmjs.com/package/plvylist">I made this player</a>.</p>
            </header>
            <plvylist-player tracks="/assets/js/alone-in-a-crowded-room.json">
            </plvylist-player>
          </section>
        </div>
      </div>
      <section class="listenBrainz flow">
        <header class="flow u-truncate">
          <h2>Listening Habits</h2>
          <p>I keep track of my listening habits in ListenBrainz because I'm a <strong>nerd</strong>. All that data is public on <a
              href="https://listenbrainz.org/user/actionhamilton/">my ListenBrainz profile</a>, but I've chosen to display a few specific
            metrics here. Cool, right?</p>
        </header>
        <div class="flow">
          <h3>Playing Now</h3>
          {% if nowPlaying %}
            <dl class="c-dataList u-font--code">
              <div class="c-dataList__item">
                <dt>Artist</dt>
                <dd>{{ nowPlaying.artist }}</dd>
              </div>
              <div class="c-dataList__item">
                <dt>Track</dt>
                <dd>{{ nowPlaying.song }}</dd>
              </div>
              <div class="c-dataList__item">
                <dt>Release</dt>
                <dd>{{ nowPlaying.release }}</dd>
              </div>
            </dl>
          {% else %}
            <p class="u-font--code">Silence (nothing)</p>
          {% endif %}
        </div>
        <div class="flow listeningHistory">
          <h3>Listening History</h3>
          <data-table
            caption="Last 30 Plays"
            headers="Number Artist Track Release"
            data='{{ recentListens | dump }}'></data-table>
          <data-table
            caption="Top Artists This Month"
            headers="Number Artist Listens"
            data='{{ topArtistsThisMonth | dump }}'></data-table>
        </div>
      </section>
    </div>
  </main>
{% endblock %}

{% block style %}
  {{ super() }}
  <style>
    .central {
      display: flex;
      flex-direction: column;
      gap: var(--space-2xl-3xl);
      margin-block-start: var(--space-2xl);
    }

    @media (min-width: 70.25rem) {
      .central {
        display: grid;
        grid-template-columns: 1fr .75fr;
      }
    }

    .o-left .header {
      --flow-space: var(--space-s);
    }

    .callout {
      font-size: var(--step-6);
    }

    .o-bands {
      --flow-space: var(--space-s);
    }

    .c-band svg {
      max-inline-size: 48px;
    }

    .c-band a {
      display: block;
      inline-size: fit-content;
    }

    plvylist-player {
      display: block;
      font-size: var(--step--1);
      margin-block: var(--space-s-m);
    }

    .listenBrainz {
      margin-block-start: var(--space-2xl-3xl);
    }

    .listenBrainz :is(h2, h3, h4) {
      margin-block-start: revert;
    }

    .listeningHistory {
      --flow-space: var(--space-m-l);
    }

    .c-dataList__item {
      display: flex;
      gap: 1ch;
    }

    .c-dataList__item dt {
      font-weight: bold;
    }

    .c-dataList__item dt::after {
      content: ":"
    }
  </style>
{% endblock %}
